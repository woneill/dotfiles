{{- $expected_plugins_default := list "direnv" "helm" "helm-docs" "helmfile" "java" "kubectl" "kubetail" "maven" "nodejs" "python" "ruby" "terraform" "terraform-docs" "terraformer" "tflint" "tfsec" -}}
{{- $expected_plugins := "" -}}
{{ if eq .category "home" -}}
{{- $expected_plugins = $expected_plugins_default | sortAlpha | join " " -}}
{{ end -}}
{{ if eq .category "tpt" -}}
{{- $expected_plugins = concat $expected_plugins_default ( list "brig" "golang" "kubetail") | uniq | sortAlpha | join " " -}}
{{ end -}}
#!/usr/bin/env zsh

command -v asdf >/dev/null 2>&1 && {
    typeset -A a2
    for k in $(asdf plugin list); do
        a2[$k]=1
    done

    for k in {{ $expected_plugins }}; do
        if [ ! "${a2[$k]}" ]; then
            asdf plugin add $k
        fi
        unset "a2[$k]"
    done

    if [ ! -z "${(k)a2}" ]; then
        echo "ASDF plugins installed but not expected: ${(k)a2}"
    fi
}
